Settings:
	width := 285
	labelsx := (width/8)-3
	inputw := (width/2)
	lpwwidth:=56
	lpwpos:=(inputw/2)-(lpwwidth/2)+18
	
	Gui, Settings:New, +hwndGeneralSettings
	Gui, +LastFound
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h30 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, % "x0 y6 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0", Options

		Gui, Color, %guicolor%, 252525
		Gui, Font, s9
		Gui, Font, normal

	Gui, Add, Text, % "x" labelsx " w137 y+25", Start with Windows
	Gui, Add, DropDownList, % "x+0 w80 yp-3 Center vStartWithWindows 0x200 Choose" StartWithWindows " AltSubmit" , No|Yes

	Gui, Add, Text, % "x0 y+14 w" width " Center", Optional:
	Gui, Font, s9 cDFDFDF
	Gui, Add, Text, % "x0 y+3 w" width " Center", (Use keys to output anywhere)
	Gui, Font, s9 cFFFFFF

	Gui, Add, Text, % "x" labelsx " w75 y+12", Email:
	Gui, Add, Edit, % "x+0 yp-1 w" inputw " h16 hwndEdit6 vemail -E0x200 +Center -VScroll", %email%
	SetEditCueBanner(Edit6, "CapsLock x2")
	Gui, Add, Button, % "x+2 yp-1 w21 h17 gSettingsTipEmail hwndSettingsTipEmail -TabStop +Center", ?
	Gui, Add, Text, % "x" labelsx " w75 y+10", Password:
	Gui, Add, Edit, % "x+0 yp-1 w" inputw " h16 hwndEdit7 vpassword +password -E0x200 +Center -VScroll", %password%
	SetEditCueBanner(Edit7, "Win + CapsLock x2")
	Gui, Add, Button, % "x+2 yp-1 w21 h17 gSettingsTipPassword hwndSettingsTipPassword -TabStop +Center", ?

	Gui, Add, Text, % "x" labelsx " w120 y+18", Password expiration ›
	Gui, Add, DropDownList, % "x+17 w80 yp-3 Center vPasswordExpiration Choose" PasswordExpiration " AltSubmit" , Secure|Never|Always Ask
	Gui, Add, Button, % "x+2 yp-0 w23 h23 gOtherTipPasswordExpiration hwndOtherTipPasswordExpiration -TabStop +Center", ?

	Gui, Font, s10 w600
	Opt1 := [6, "0x" . guicolor, "0x" . guicolor, "White"]
	Opt2 := [ , "0x" . guicolor, "0x" . btnhovercolor, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	if (!FirstRun)
	{
		Gui, Add, Button, % "x" (width/2)-((width*0.80)/2) " y+22 w" (width*0.80) " h36 gChangeHotkeys hwndBut1 +Center", Configure Hotkeys

		Gui, Add, Button, % "x" (width/2)-((width*0.80)/2) " y+2 w" (width*0.80) " h36 gUninstallPrompt hwndBut2 +Center", Uninstall
	}
	else
	{
		Gui, Add, Button, % "x" (width/2)-((width*0.80)/2) " y+18 w" (width*0.80) " h36 gLearnMore hwndBut1 +Center", Learn More
	}

	Gui, Font, s9
	Gui, Font, normal

	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Gui, Add, Button, % "x" (width/2)-(width*0.38)-2 " y+" (FirstRun ? "12" : "12") " w" (width*0.38) " h30 gMainMenuApply hwndBut3 +Center +Default", % (FirstRun) ? "Install" : "Apply"

	if (FirstRun)
		Gui, Add, Button, % "x+5 w" (width*0.38) " h30 gmnuUninstall hwndBut4 +Center", Cancel
	else
		Gui, Add, Button, % "x+5 w" (width*0.38) " h30 gdestroyset hwndBut4 +Center", Cancel	

	Gui, Add, Text, % "x7 y+12 w" (width-14) " h2 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	if !FirstRun
	{
		ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	}
	ImageButton.Create(But3, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But4, Opt1, Opt2, "", Opt4)
	Opt1 := [6, "0x" . guicolor, "0x" . guicolor, "White"]
	Opt2 := [ , 0x009494, 0x009494, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	ImageButton.Create(SettingsTipEmail, Opt1, Opt2, "", Opt4)
	ImageButton.Create(SettingsTipPassword, Opt1, Opt2, "", Opt4)
	ImageButton.Create(OtherTipPasswordExpiration, Opt1, Opt2, "", Opt4)
	ShAutoComplete(Edit6)
	ShAutoComplete(Edit7)
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r6-6"
	Gui, Show, % "w" width, Script Options
	FadeIn(GeneralSettings)
return

MainMenuApply:
	Gui, Submit, NoHide

	passwordhash:=Crypt.Encrypt.StrEncrypt(password,"KktgC3l0wR",7,3)
	IniWrite, %passwordhash%, settings.ini, settings, passwordhash
	IniWrite, %email%, settings.ini, settings, email
	IniWrite, %StartWithWindows%, settings.ini, settings, StartWithWindows
	IniWrite, %PasswordExpiration%, settings.ini, settings, PasswordExpiration

	If PasswordExpiration!=2
	{
		Authorized:=false
		IniDelete, settings.ini, settings, passwordNoExpirationHash
	}

	FadeOut(GeneralSettings)
	If FirstRun
	{
		RSNotify("Installed")
		IniWrite, 1, settings.ini, settings, AfterInstallation
	}
	else
		RSNotify("Applied")
	SplitPath, A_Scriptname, , , , OutNameNoExt
	LinkFile=%A_Startup%\%OutNameNoExt%.lnk
	StartMenuFile=%A_StartMenu%\Programs\%ScriptName%.lnk
	If StartWithWindows=2
	{
		If A_IsCompiled=1
		{
			FileCreateShortcut, %A_ScriptFullPath%, %LinkFile%
			FileCreateShortcut, %A_ScriptFullPath%, %StartMenuFile%
			If FirstRun
				IniWrite, 1, settings.ini, settings, CreateATask
			else if A_IsAdmin
				Run, %comspec% /c SchTasks /SC ONLOGON /F /Create /TN RSRunScript /RL HIGHEST /TR "%A_ScriptDir%\%ScriptName%".exe, , HIDE
		}
	}
	else if StartWithWindows=1
	{
		FileDelete, %LinkFile%
		if A_IsAdmin
			Run, %comspec% /c SchTasks /F /Delete /TN RSRunScript, , HIDE
	}
	If FirstRun
	{
		SetTimer, ARun, -1600
		FirstRun:=false
	}
return

destroyset:
	If FirstRun
	{
		RSNotify("Careful, no settings!")
		SetTimer, ARun, -1600
	}
	FirstRun:=false
	FadeOut(GeneralSettings)
return

;--------------------------------------------------------------------------------------------------------------

ExtSettings:
	width := 300
	labelsx := (width/7)+30
	inputw := (width/2)
	lpwwidth:=56
	lpwpos:=(inputw/2)-(lpwwidth/2)+18

	Gui, ExtSettings:New, +hwndExtHWND
	Gui, +LastFound
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h30 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, % "x0 y6 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0", Extensions

	Gui, Color, 2e2e2e, 333333
	Gui, Font, s8, Tahoma
	Gui, Font, normal

	Gui, Add, Text, % "x0 y+25 w" width " Center", -    Built in    -

	Gui, Add, Text, % "x5 y+15 w" (width/2) " Center ", Lock Screen
	
	Opt1 := [6, 0x373737, 0x373737, 0xD0D0D0, 10, 0x2e2e2e,, 4]
	Opt2 := [ , 0x3f3f3f, 0x3f3f3f]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	Gui, Add, Button, % "x" width*0.75-34 " yp-3 w63 h21 Section gProtectionSettings hwndButProtection +Center", Settings 
	ImageButton.Create(ButProtection, Opt1, Opt2, "", Opt4)

	Gui, Add, Text, % "x5 y+15 w" (width/2) " Center ", Fast Search
	Gui, Add, DropDownList, % "xs+0 yp-3 w65 Center Section vFastSearchWanted Choose" FastSearchWanted " AltSubmit" , Enabled|Disabled
	Gui, Add, Text, % "x5 y+15 w" (width/2) " Center ", LAlt to Minimize
	Gui, Add, DropDownList, % "xs+0 yp-3 w65 Center vAltMinimizeWanted Choose" AltMinimizeWanted " AltSubmit" , Enabled|Disabled
	Gui, Add, Text, % "x5 y+15 w" (width/2) " Center ", Volume Over Tray
	Gui, Add, DropDownList, % "xs+0 yp-3 w65 Center vVolumeOTWanted Choose" VolumeOTWanted " AltSubmit" , Enabled|Disabled

	IfExist, *.ahk
	{
		Opt1 := [6, 0x333333, 0x333333, 0xD0D0D0, 10, 0x2e2e2e,, 4]
		Opt2 := [ , 0x3f3f3f, 0x3f3f3f]
		Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

		CustomExtensionNames := {}
		Gui, Add, Text, % "x0 y+25 w" width " Center", -   Others   -
		Loop, Files, *.ahk
		{
			SplitPath, A_LoopFileLongPath,,,, PluginName

			If RegExMatch(PluginName, "\W")
			{
				PluginName:=StrReplace(PluginName, A_Space, "_")
				PluginName := RegExReplace(PluginName, "\W")
				FileMove, %A_LoopFileLongPath%, %PluginName%.ahk, 1
			}

			IniRead, PluginState, settings.ini, plugins, PluginState%PluginName%, 1
			PluginNameNoUnderscores:=StrReplace(PluginName, "_", A_Space)
			Gui, Add, Button, % "x" width/4-(width/6)+5 " y+14 h25 w" (width/2.5) " gEditPlugin hwndPluginEditButton Center -Wrap", %PluginNameNoUnderscores% ›

			; !POSITION IMPORTANT! Keep after the button creation. Get the last character of the variable EXTControls which is the number of the button created. 
			WinGet, EXTControls, ControlList, ahk_id %ExtHWND%
			Loop, Parse, EXTControls,  `n, `r  
			{
				lastLine:=A_LoopField
			}
			CustomExtensionNames.Insert(lastLine, PluginName)
			

			ImageButton.Create(PluginEditButton, Opt1, Opt2, "", Opt4)

			ExtensionButtonsExist := true
			Gui, Add, DropDownList, % "xs+0 yp+0 w65 Center vPluginState" PluginName " Choose" PluginState " AltSubmit" , On|Off|Delete
		}
	}

	Gui, Font, s10 cFFFFFF Bold, Segoe UI

	Gui, Add, Button, % "x" (width/2)-((width*0.55)/2) " y+" (20+!ExtensionButtonsExist*8) " w" (width*0.55) " h33 gCreateExtensionGUI hwndBut1 +Center", Create Extension

	Gui, Add, Button, % "x" (width/2)-(width*0.38)-2 " y+" (10+!ExtensionButtonsExist*4) " w" (width*0.38) " h31 gextbutton hwndBut2 +Center +Default", Apply

	Gui, Add, Button, % "x+5 w" (width*0.38) " h31 gextclose hwndBut3 +Center", Cancel

	Gui, Add, Text, % "x7 y+12 w" (width-14) " h2 vP"
	GuiControlGet, P, Pos
	H := PY + PH

	If ExtensionButtonsExist
	{
		Opt1 := [6, 0x2e2e2e, 0x2e2e2e, 0xD0D0D0, 10, 0x2e2e2e]
		ExtensionButtonsExist := false
	}
	else
		Opt1 := [6, 0x333333, 0x333333, 0xD0D0D0, 10, 0x2e2e2e]

	Opt2 := [ , 0x3f3f3f, 0x3f3f3f]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	
	Opt1 := [6, 0x2e2e2e, 0x2e2e2e, "White"]
	Opt2 := [ , 0x2e2e2e, 0x3f3f3f, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But3, Opt1, Opt2, "", Opt4)
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r6-6"
	Gui, Show, w%width%, Extensions
	FadeIn(ExtHWND)
return

CreateExtensionGUI:
	FadeOut(ExtHWND)

	Gui, CreateExtensionGUI:New, +hwndCreateExtensionGUI +LastFound +ToolWindow +AlwaysOnTop
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, -Caption
	Gui, Color, 2b2b2a, 2b2b2a
	Gui, Font, s10 Bold c00afaf, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w200 h26 Background1f1f1f Disabled hwndHPROG"
	Gui, Add, Text, x0 y4 w200 Center BackgroundTrans +0x200 cb1b1b1, Name your new extension

	Gui, Font, w700 s11 cD0D0D0, Segoe UI Black
	Gui, Add, Edit, % "x0 y+13 w155 h25 hwndEdit265 vnewPluginName -E0x200 +Center -VScroll",

	Gui, Font, w700 s11 ceeeeee, Segoe UI Black
	Opt1 := [6, 0x2b2b2a, 0x2b2b2a, 0xD0D0D0]
	Opt2 := [ , 0x2b2b2a, 0x2b2b2a, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	Gui, Add, Button, x+0 w45 h25 +default gCreateExtension hwndBut1 +Center, Go
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)

	scaledw:=200
	scaledh:=70
	SHAutoComplete(Edit265)
	WinSet, Region, % "0-0 w" scaledw*dpi " h" scaledh*dpi " r12-12", ahk_id %CreateExtensionGUI%
	; NoActivate fixes weird bug with not being able to switch language
	Gui, Show, w%scaledw% h%scaledh% NoActivate, Authorization
	WinActivate	
	; -----------------
	FadeIn(CreateExtensionGUI)
return

CreateExtensionGUIGuiEscape:
FadeOut(CreateExtensionGUI)
GoSub ExtSettings
return

CreateExtension:
	Gui, Submit, NoHide

	newPluginName := RegExReplace(newPluginName, "\W")
	if !newPluginName
	{
		RSNotify("Name is required.")
		return
	}

	FadeOut(CreateExtensionGUI)

	FileInstall, Plugins/template, %A_MyDocuments%\%ScriptName%\%newPluginName%.ahk, 0
	GoSub ExtSettings
	Sleep 70
	GoSub ExitDefMenu
	pluginPath=%A_WorkingDir%\%newPluginName%.ahk
	DllCall("shell32\OpenAs_RunDLL" (A_IsUnicode ? "W" : ""),"UInt",0,"UInt",0,"Str", pluginPath)
return

EditPlugin:
	ControlGetFocus, ChosenPluginClassNN, A
	pluginPath:=A_WorkingDir . "\" . CustomExtensionNames[ChosenPluginClassNN] . ".ahk"
	DllCall("shell32\OpenAs_RunDLL" (A_IsUnicode ? "W" : ""),"UInt",0,"UInt",0,"Str", pluginPath)
	GoSub ExitDefMenu
return

extbutton:
Gui, Submit, NoHide
IfExist, *.ahk
{
	Loop, Files, *.ahk
	{
		SplitPath, A_LoopFileLongPath,,,, PluginName

		If RegExMatch(PluginName, "\W")
		{
			PluginName:=StrReplace(PluginName, A_Space, "_")
			PluginName := RegExReplace(PluginName, "\W")
			FileMove, %A_LoopFileLongPath%, %PluginName%.ahk, 1
		}

		If % PluginState%PluginName%=1
		{
			IniWrite, % PluginState%PluginName%, settings.ini, plugins, PluginState%PluginName%
			Run, %A_MyDocuments%\%ScriptName%\Extensions %A_MyDocuments%\%ScriptName%\%PluginName%.ahk,,, PID%PluginName% ; PluginID is the PID for the process. Required when you need to close/uninstall the program.
			RunningPlugins.Push("PID" PluginName)
		}
		else if % PluginState%PluginName%=2
		{
			IniWrite, % PluginState%PluginName%, settings.ini, plugins, PluginState%PluginName%
			IfWinExist, % "ahk_pid" PID%PluginName%
				WinKill, % "ahk_pid" PID%PluginName%
		}
		else if % PluginState%PluginName%=3
		{
			IniDelete, settings.ini, plugins, PluginState%PluginName%
			IfWinExist, % "ahk_pid" PID%PluginName%
				WinKill, % "ahk_pid" PID%PluginName%
			FileDelete, %PluginName%.ahk
		}
	}
}
IniWrite, %FastSearchWanted%, settings.ini, settings, FastSearchWanted
IniWrite, %AltMinimizeWanted%, settings.ini, settings, AltMinimizeWanted
IniWrite, %VolumeOTWanted%, settings.ini, settings, VolumeOTWanted

If FastSearchWanted=1
	GuiControl, Functions:, RAltVar, Right Alt
else
	GuiControl, Functions:, RAltVar, Off

If AltMinimizeWanted=1
	GuiControl, Functions:, AltMinimizeVar, Alt x 2
else
	GuiControl, Functions:, AltMinimizeVar, Off

If VolumeOTWanted=1
	GuiControl, Functions:, VolumeOTVar, Scroll Over Tray
else
	GuiControl, Functions:, VolumeOTVar, Off

FadeOut(ExtHWND)
return

extclose:
FadeOut(ExtHWND)
return

;--------------------------------------------------------------------------------------------------------------

ProtectionSettings:
	IniWrite, %assignedKeyLock%, settings.ini, settings, keyLock ; keep these here
	IniRead, keyLock, settings.ini, settings, keyLock, ScrollLock ; keep these here

	If BreakLoop=1
		ChooseBL=1
	Else
		ChooseBL=2

	width := 285
	Gui, ProtectionMenu:New, +hwndProtectionSettings
	Gui, +LastFound
	WinSet, Transparent, 0
	Gui, Color, 808080
	Gui, Margin, 0, 0
	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h30 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, % "x0 y6 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0", Protection Settings
		Gui, Color, %guicolor%, 333333
		
	Gui, Font, s8 cFFFFFF Bold, Segoe UI		
	Gui, Add, Text, % "x0 y+25 w" (width/2) " Center", Protection ›
	Gui, Font, s8, Tahoma
	Gui, Font, normal

	Gui, Add, DropDownList, % "x+" (width/4)-50 " w87 yp-3 Center gGrayOutControls vBreakLoop Choose" ChooseBL " AltSubmit" , On|Off
	Gui, Add, Button, % "x+2 yp-1 w22 h23 gProtectionTipBreakLoop hwndProtectionTipBreakLoop -TabStop +Center", ?

	Gui, Font, s8 cFFFFFF Bold, Segoe UI
	Gui, Add, Text, % "x0 y+19 w" (width/2) " Center", PIN ›
	Gui, Font, s8, Tahoma
	Gui, Font, normal
	Gui, Add, Edit, % "x+" (width/4)-50 " w87 h15 vNewLockPw hwndEdit8 +password -E0x200 +Center -VScroll +Number", %LockPw%
	Gui, Add, Button, % "x+2 yp-1 w22 h17 gProtectionTipNewLockPw hwndProtectionTipNewLockPw -TabStop +Center", ?

	Gui, Font, s8 cFFFFFF Bold, Segoe UI
	Gui, Add, Text, % "x0 y+13 w" (width/2) " Center", Seconds Until Lock ›
	Gui, Font, s8, Tahoma
	Gui, Font, normal
	Gui, Add, Edit, % "x+" (width/4)-50 " w87 h15 hwndEdit1 vseconds -E0x200 +Center -VScroll +Number", %seconds%
	Gui, Add, Progress, % "yp-0 w87 h15 vSecondsUntilLockReplacement Background3a3a3a Disabled hwndHPROG"

	Gui, Add, Button, % "x+2 yp-1 w22 h17 gProtectionTipSeconds hwndProtectionTipSeconds -TabStop +Center", ?

	; Gui, Add, Text, % "x0 y+13 w" (width/2) " Center", Fullscreen delay ›
	; Gui, Add, Edit, % "x+" (width/4)-50 " w87 h15 hwndEdit1 vdelayseconds -E0x200 +Center -VScroll +Number", %delayseconds%
	; Gui, Add, Button, % "x+2 yp-1 w22 h17 gProtectionTipDelaySeconds hwndProtectionTipDelaySeconds -TabStop +Center", ?

	Gui, Add, Text, % "x0 y+14 w" (width/2) " Center", Lock After Sleep ›
	Gui, Add, DropDownList, % "x+" (width/4)-50 " w87 yp-3 Center vAfterWU Choose" AfterWU " AltSubmit" , On|Off
	Gui, Add, Button, % "x+2 yp-1 w22 h23 gProtectionTipAfterWU hwndProtectionTipAfterWU -TabStop +Center", ?

	Gui, Add, Text, % "x0 y+14 w" (width/2) " Center", Lock After Videos ›
	Gui, Add, DropDownList, % "x+" (width/4)-50 " w87 yp-3 Center vAfterFS Choose" AfterFS " AltSubmit" , On|Off
	Gui, Add, Button, % "x+2 yp-1 w22 h23 gProtectionTipAfterFS hwndProtectionTipAfterFS -TabStop +Center", ?

	Gui, Add, Text, % "x0 y+14 w" (width/2) " Center", Security Logs ›
	Gui, Add, DropDownList, % "x+" (width/4)-50 " w87 yp-3 Center vlogging Choose" logging " AltSubmit" , On|Off
	Gui, Add, Button, % "x+2 yp-1 w22 h23 gProtectionTipLogging hwndProtectionTipLogging -TabStop +Center", ?

	Gui, Add, Text, % "x0 y+14 w" (width/2) " Center", Animation ›
	Gui, Add, DropDownList, % "x+" (width/4)-50 " w87 yp-3 Center vAnimationWanted Choose" AnimationWanted " AltSubmit" , On|Off

	Gui, Add, Text, % "x0 y+14 w" (width/2) " Center", Clock ›
	Gui, Add, DropDownList, % "x+" (width/4)-50 " w87 yp-3 Center vClockWanted Choose" ClockWanted " AltSubmit" , On|Off

	Gui, Add, Text, % "x0 y+20 w" (width/2) " Center", Force Lock Key ›
	Gui, Add, Hotkey, % "x+" (width/4)-50 " yp-4 w87 Center vassignedKeyLock" , %keyLock%

	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Opt1 := [6, "0x" . guicolor, "0x" . guicolor, "White"]
	Opt2 := [ , "0x" . guicolor, "0x" . btnhovercolor, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	If(logging=1)
	{
		Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " y+16 w" (width*0.64) " h33 gSecurityLoggingLabel hwndBut2 +Center", Security Logs
		ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
		Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " y+2 w" (width*0.64) " h33 gPrInfo hwndBut1 +Center", Info
	}
	else
	{
		Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " y+16 w" (width*0.64) " h33 gPrInfo hwndBut1 +Center", Info
	}

	Gui, Add, Button, % "x" (width/2)-(width*0.38)-2 " y+10 w" (width*0.38) " h31 gprotectionbutton hwndBut3 +Center +Default", Apply

	Gui, Add, Button, % "x+5 w" (width*0.38) " h31 gdestroyprot hwndBut4 +Center",Cancel

	Gui, Add, Text, % "x+1 h46 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But3, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But4, Opt1, Opt2, "", Opt4)
	Opt1 := [6, "0x" . guicolor, "0x" . guicolor, "White"]
	Opt2 := [ , 0x009494, 0x009494, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	ImageButton.Create(ProtectionTipBreakLoop, Opt1, Opt2, "", Opt4)
	ImageButton.Create(ProtectionTipNewLockPw, Opt1, Opt2, "", Opt4)
	ImageButton.Create(ProtectionTipSeconds, Opt1, Opt2, "", Opt4)
	ImageButton.Create(ProtectionTipDelaySeconds, Opt1, Opt2, "", Opt4)
	ImageButton.Create(ProtectionTipAfterFS, Opt1, Opt2, "", Opt4)
	ImageButton.Create(ProtectionTipAfterWU, Opt1, Opt2, "", Opt4)
	ImageButton.Create(ProtectionTipLogging, Opt1, Opt2, "", Opt4)
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r6-6"
	Gui, Show, % "w" width , Protection Settings
	GoSub GrayOutControls
	FadeIn(ProtectionSettings)

	FirstTimeOpenedAction("ProtectionSettings", "PrInfo")
return

destroyprot:
FadeOut(ProtectionSettings)
return

GrayOutControls:
	GuiControlGet, IsBreakLoopEnabled, ProtectionMenu:, BreakLoop
	If IsBreakLoopEnabled=2
	{
		GuiControl, ProtectionMenu:Hide, seconds
		GuiControl, ProtectionMenu:Show, SecondsUntilLockReplacement
		GuiControl, ProtectionMenu:Disable, AnimationWanted
		GuiControl, ProtectionMenu:Disable, AfterWU
		GuiControl, ProtectionMenu:Disable, AfterFS
		GuiControl, ProtectionMenu:Disable, logging
		GuiControl, ProtectionMenu:Disable, ClockWanted
	}
	else
	{
		GuiControl, ProtectionMenu:Show, seconds
		GuiControl, ProtectionMenu:Hide, SecondsUntilLockReplacement
		GuiControl, ProtectionMenu:Enable, AnimationWanted
		GuiControl, ProtectionMenu:Enable, AfterWU
		GuiControl, ProtectionMenu:Enable, AfterFS
		GuiControl, ProtectionMenu:Enable, logging
		GuiControl, ProtectionMenu:Enable, ClockWanted
	}
return

protectionbutton:
	Gui, Submit, NoHide

	MetRequirements:=True
	If BreakLoop=1
	{
		If !NewLockPw
		{
			Warning:="A password is needed."
			GoSub WarningGUI
			MetRequirements:=False
		}
		Else If NewLockPw is not digit
		{
			Warning:="Password needs to be a number."
			GoSub WarningGUI
			MetRequirements:=False
		}
		Else If seconds=0
		{
			Warning:="Seconds need to be higher than 0."
			GoSub WarningGUI
			MetRequirements:=False
		}
		Else If seconds=""
		{
			Warning:="Please input seconds."
			GoSub WarningGUI
			MetRequirements:=False
		}
		Else If seconds is not number
		{
			Warning:="Seconds need to be a number."
			GoSub WarningGUI
			MetRequirements:=False
		}
		If(MetRequirements=0)
		{
			BreakLoop=0
			return
		}
	}

	If (NewLockPw!=LockPw && LockPw)
	{
		DontShowRS:=true
		AuthReq:=true
		cancelChange:=false
		GoSub LockNow
		WinWaitActive, ahk_id %ZPHWND%
		WinWaitNotActive, ahk_id %ZPHWND%
		If cancelChange
		{
			GuiControl,  ProtectionMenu:, NewLockPW, %LockPw%
			RSNotify("Canceled")
			return
		}
	}
	if !cancelChange
		LockPw:=NewLockPw

	LockPwHash:=Crypt.Encrypt.StrEncrypt(LockPw,"KktgC3l0wR",7,3)
	IniWrite, %LockPwHash%, settings.ini, settings, LockPwHash
	IniWrite, %assignedKeyLock%, settings.ini, settings, keyLock
	IniWrite, %BreakLoop%, settings.ini, settings, breakloop
	IniWrite, %ClockWanted%, settings.ini, settings, ClockWanted
	IniWrite, %AfterFS%, settings.ini, settings, AfterFS
	IniWrite, %AfterWU%, settings.ini, settings, AfterWU
	IniWrite, %logging%, settings.ini, settings, LoggingLockTimes
	IniWrite, %AnimationWanted%, settings.ini, settings, AnimationWanted
	If AnimationWanted!=1
		DontShowRS:=true
	else
		DontShowRS:=false

	FadeOut(ProtectionSettings)
	IniWrite, %seconds%, settings.ini, settings, seconds
	If BreakLoop=1
		Gosub Protection
	If (keyLock!="None" && keyLock!="" and keyLock!=assignedKeyLock)
		Hotkey, %keyLock%, LockNow, Off
	GoSub ButtonsLabel
return

;--------------------------------------------------------------------------------------------------------------

ScriptFunctions:
	width := 350
	Gui, Functions:New, +hwndSFunctions
	Gui, +LastFound
	WinSet, Transparent, 0
	Gui, Color, %guicolor%
	Gui, Margin, 0, 0
	Gui, Font, s11 cD0D0D0 Bold
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h67 Background1F2326 Disabled hwndHPROG"
	If AfterInstallation=1
	{
		Gui, Add, Text, % "x0 y1 w" width " h30 BackgroundTrans Center 0x200 gGuiMove vCaption", Welcome!
		Gui, Font, s8 c228a96, Tahoma
		Gui, Add, Text, % "x0 y+0 w" (width) " Center BackgroundTrans", Here are all the functions that are available to you.
		Gui, Add, Text, % "x0 y+2 w" (width) " Center BackgroundTrans", You can download extensions from our website.
		IniWrite, 0, settings.ini, settings, AfterInstallation
		AfterInstallation=0
	}
	else
	{
		Gui, Add, Text, % "x0 y0 w" width " h30 BackgroundTrans Center 0x200 gGuiMove vCaption", Features
		Gui, Font, s8 c228a96, Tahoma
		Gui, Add, Text, % "x-2 y+0 w" (width) " Center BackgroundTrans", Some hotkeys/features are configurable
		Gui, Add, Text, % "x-2 y+2 w" (width) " Center BackgroundTrans", Check "Configure Hotkeys"
	}
	Gui, Font, s10 c%lightc%, Tahoma
	Gui, Add, Text, % "x0 y+15 w" (width/2) " Center BackgroundTrans", Function
	Gui, Font, s10 c%lightc%, Tahoma
	Gui, Add, Text, % "x+2 w" (width/2) " Center BackgroundTrans", Keys

	Gui, Add, Text, % "x0 y+0 w" width " h3 Center ",
	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Speed Dial
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+0 w" (width/2) " vassignedKeyRSWebVar Center", %assignedKeyRSWeb%

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Speed Dial a website
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " vassignedKeyRSWeb2Var Center", %assignedKeyRSWeb% + 1/2/3...8
	
	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Play/Pause:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " vassignedKeyPlayVar Center", %assignedKeyPlay%

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Previous:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " vassignedKeyPrevVar Center", %assignedKeyPrev%

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Next:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " vassignedKeyNextVar Center", %assignedKeyNext%

	Gui, Add, Text, % "x0 y+0 w" width " h11 Center ",

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Fast Search
	Gui, Font, s8 c%lightc%, Tahoma
	If FastSearchWanted=1
		Gui, Add, Text, % "x+1 w" (width/2) " Center vRAltVar", Right Alt
	else
		Gui, Add, Text, % "x+1 w" (width/2) " Center vRAltVar", Off

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x3 y+6 w" (width/2) " Center ", Minimize Current App:
	Gui, Font, s8 c%lightc%, Tahoma
	If AltMinimizeWanted=1
		Gui, Add, Text, % "x+0 w" (width/2) " Center vAltMinimizeVar",  Alt x 2
	Else
		Gui, Add, Text, % "x+0 w" (width/2) " Center vAltMinimizeVar",  Off

	Gui, Add, Text, % "x0 y+0 w" width " h11 Center ",

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+6 w" (width/2) " Center ", Volume Control:
	Gui, Font, s8 c%lightc%, Tahoma
	If VolumeOTWanted=1
		Gui, Add, Text, % "x+1 w" (width/2) " Center vVolumeOTVar", Scroll Over Tray
	Else
		Gui, Add, Text, % "x+1 w" (width/2) " Center vVolumeOTVar", Off

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Volume Up:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " vassignedKeyVolUpVar Center", %assignedKeyVolUp%

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Volume Down:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " vassignedKeyVolDownVar Center", %assignedKeyVolDown%

	Gui, Add, Text, % "x0 y+0 w" width " h11 Center ",

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+12 w" (width/2) " Center ", Lock Now:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " vassignedKeyLockVar Center", %assignedKeyLock%

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Input Email:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " Center", CapsLock x 2

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Input Password:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " Center", Win + CapsLock x 2

	Gui, Add, Text, % "x0 y+0 w" width " h11 Center ",

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Restart program:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " Center", Win + Alt + R

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Suspend hotkeys:
	Gui, Font, s8 c%lightc%, Tahoma
	Gui, Add, Text, % "x+1 w" (width/2) " Center", Win + Alt + S

	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Opt1 := [6, "0x" . guicolor, "0x" . guicolor, "White"]
	Opt2 := [ , "0x" . guicolor, "0x" . btnhovercolor, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " y+19 w" (width*0.64) " h36 gLearnMore hwndBut1 +Center", Learn More

	Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " y+2 w" (width*0.64) " h36 gsubit +hwndBut2 +Default", Close

	Gui, Add, Text, % "x7 y+10 w" (width-14) " h2 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r6-6"
	Gui, Show, % "w" width " NA", Functions
	GoSub SetButtons
	FadeIn(SFunctions)
return

subit:
FadeOut(SFunctions)
 	Gui, Submit, NoHide
return

SetButtons:
	keysArray=assignedKeyRSWeb|assignedKeyPlay|assignedKeyPrev|assignedKeyNext|assignedKeyVolUp|assignedKeyVolDown|assignedKeyLock
	Loop, Parse, keysArray, `|
	{
		Replacement:=RegExReplace(%A_LoopField%, "[\^]", "Ctrl & ")
		Replacement:=RegExReplace(Replacement, "[!]", "Alt & ")
		Replacement:=RegExReplace(Replacement, "[+]", "Shift & ")
		Replacement:=RegExReplace(Replacement, "[&]", "+")
		If % %A_LoopField%!="None"
			GuiControl, Functions:, %A_LoopField%Var, % Replacement
		else
			GuiControl, Functions:, %A_LoopField%Var, Off
	}

	If assignedKeyRSWeb!=None
		GuiControl, Functions:, assignedKeyRSWeb2Var, %assignedKeyRSWeb% + 1/2/3...8
	else
		GuiControl, Functions:, assignedKeyRSWeb2Var, Off
return

;--------------------------------------------------------------------------------------------------------------

ChangeHotkeys:

	keysArray=keyRSWeb|keyPlay|keyPrev|keyNext|keyVolUp|KeyVolDown|keyLock
	Loop, Parse, keysArray, `|
	{
		IniWrite, % assigned%A_LoopField%, settings.ini, settings, %A_LoopField%
		IniRead, %A_LoopField%, settings.ini, settings, %A_LoopField%
	}
	
	width := 290
	Gui, ChangeHotkeys:New, +hwndChangeHotkeys
	Gui, +LastFound
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h30 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, % "x0 y6 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0", Change Hotkeys

	Gui, Color, 2e2e2e, 333333
	Gui, Font, s8, Tahoma

	Gui, Font, s8 c%darkerc%, Tahoma
	Gui, Add, Text, % "x14 y+28 w" (width/2) " Center ", Hotkeys in Fullscreen ›
	Gui, Add, DropDownList, % "x+20 w72 yp-3 Center vhotkeysInFullScreen Choose" hotkeysInFullScreen " AltSubmit" , Yes|No

	Gui, Add, Text, % "x0 y+26 w" (width) " Center ", Press Delete on a hotkey to disable it

	Gui, Add, Text, % "x0 y+26 w" (width/2) " vLabelSP Center ", Speed Dial
	Gui, Add, Hotkey, % "x+34 w72 Center gRSWebKeyModifiersCheck vassignedKeyRSWeb" , %keyRSWeb%

	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Play/Pause
	Gui, Add, Hotkey, % "x+34 w72 Center vassignedKeyPlay" , %keyPlay%

	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Previous
	Gui, Add, Hotkey, % "x+34 w72 Center vassignedKeyPrev" , %keyPrev%

	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Next
	Gui, Add, Hotkey, % "x+34 w72 Center vassignedKeyNext" , %keyNext%

	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Volume Up
	Gui, Add, Hotkey, % "x+34 w72 Center vassignedKeyVolUp" , %keyVolUp%

	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Volume Down
	Gui, Add, Hotkey, % "x+34 w72 Center vassignedKeyVolDown" , %keyVolDown%

	Gui, Add, Text, % "x0 y+8 w" (width/2) " Center ", Lock
	Gui, Add, Hotkey, % "x+34 w72 Center vassignedKeyLock" , %keyLock%

	Gui, Font, s10 cFFFFFF Bold, Segoe UI
	Opt1 := [6, 0x2e2e2e, 0x2e2e2e, "White"]
	Opt2 := [ , 0x2e2e2e, 0x3f3f3f, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	Gui, Add, Button, % "x" (width/2)-(width*0.38)-2 " y+32 w" (width*0.38) " h31 gchangebutton hwndBut1 +Center +Default", Apply

	Gui, Add, Button, % "x+5 w" (width*0.38) " h31 gchangeclose hwndBut2 +Center",Cancel

	Gui, Add, Text, % "x+1 h44 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r6-6"
	Gui, Show, w%width%, Change Hotkeys
	GuiControl, Focus, LabelSP
	FadeIn(ChangeHotkeys)
return

ChangeButton:
	Gui, Submit, NoHide
	keysArray=keyRSWeb|keyPlay|keyPrev|keyNext|keyVolUp|KeyVolDown|keyLock
	Loop, Parse, keysArray, `|
	{
		IniWrite, % assigned%A_LoopField%, settings.ini, settings, %A_LoopField%
		If (%A_LoopField%!="None" && %A_LoopField%!="" and %A_LoopField%!=assigned%A_LoopField%)
			Hotkey, % %A_LoopField%, Off
	}
	GoSub ButtonsLabel

	IniWrite, %hotkeysInFullScreen%, settings.ini, settings, hotkeysInFullScreen
	If hotkeysInFullscreen=2
		SetTimer, HotkeysSuspendCheck, 500
ChangeClose:
	GoSub SetButtons
	FadeOut(ChangeHotkeys)
return

RSWebKeyModifiersCheck:    ; Prevents the HotKey box from accepting any combination of the Ctrl, Alt, and Shift keys. ; Credit where it is due: Shadowpheonix at autohotkey.com/boards/viewtopic.php?t=19518
	Gui, Submit, NoHide
	assignedKeyRSWeb := RegExReplace(assignedKeyRSWeb, "[!^+]*(.*)", "$1")
	GuiControl, ChangeHotkeys:, assignedKeyRSWeb, %assignedKeyRSWeb%
Return
;--------------------------------------------------------------------------------------------------------------

LearnMore:
	IniRead, InstalledVersion, build.ini, build, Version, 1.0
	IniRead, UpdateVersion, build_update.ini, build, Version, 1.0
	width=310
	height=400
	Gui, LearnMore:New, +hwndLearnMore +LastFound -Caption
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, Color, 2e2e2e
	Gui, Font, s10 Bold, Tahoma

	TabIndex=1
	TabCount=6
	LearnMoreLabels := ["Speed Dial", "Search Bar", "Volume Control", "Protection", "Extensions", "About Us"]

	Opt1 := [6, 0x343434, 0x343434, 0xD0D0D0, 10, 0x2e2e2e]
	Opt2 := [ , 0x3f3f3f, 0x3f3f3f]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	Gui, Add, Progress, % "x-1 y-1 w" width " h32 Background272727 Disabled hwndHPROG"
	Gui, Font, s10 cFFFFFF Bold, Tahoma
	Gui, Add, Text, x0 y7 w%width% Center BackgroundTrans +0x200 gGuiMove cD0D0D0, Learn More
	Gui, Add, Button, % "x25 y+20 w35 h24 gLearnMorePrev hwndLearnMorePrevTab -TabStop +Center", <
	Gui, Font, s10 cD0D0D0, Tahoma
	Gui, Add, Text, % "x" (width/2)-(width*0.58/2)  " yp+5 w" (width*0.58) " vLearnMoreLabel Center Section", Speed Dial
	Gui, Add, Button, % "x" width-55 " w34 yp-5 h24 gLearnMoreNext hwndLearnMoreNextTab -TabStop +Center", >

	ImageButton.Create(LearnMorePrevTab, Opt1, Opt2, "", Opt4)
	ImageButton.Create(LearnMoreNextTab, Opt1, Opt2, "", Opt4)

	Gui, Add, Text, % "x15 ys+45 r16 w" width-30 " Center vTab11", % "Speed Dial is designed to make accessing websites, folders or files easier."
	. "`n`nYou can open the Speed Dial interface by pressing the assigned hotkey. `n`nTo go to an item directly, without displaying the interface, just use a combination of your hotkey(" assignedKeyRSWeb ")"
	. "+ a number from 1 to 8.`n`nTo edit a Speed Dial entry, right click`non it from the interface. Add files and folders as absolute paths(file explorer)."

	Gui, Add, Text, % "x15 ys+35 r11 w" width-30 " Center +Hidden vTab21", % "The Fast Search bar can be" 
	. " accessed by pressing the Right Alt key. To search within Google.com just type directly into the search bar and press Enter. " 
	. "To search elsewhere, you can use keywords at the beginning of your search query. Typing in a keyword, followed by pressing Space will display a label"
	. " corresponding to the website. To clear it press Backspace."
	. "`n`nThe default keywords are:"

	Gui, Add, Text, % "x15 y+0 r2 w" width-30 " vTab22 +Hidden Center c" guicolor, % "'g'    'y'    'tr'    'maps'"
	Gui, Add, Text, % "x15 y+0 r5 w" width-30 " vTab23 +Hidden Center", % "To add a new one click on the 3 dots.`nTo edit an existing keyword just Right Click on the website's label."

	Gui, Add, Text, % "x15 ys+45 r16 w" width-30 " Center vTab31 +Hidden", % "Use your mouse to control the system volume by hovering over the taskbar."
	. "`n`nTo take advantage of this feature, put your mouse above the taskbar and scroll up or down to increase/decrease your sound volume.You will notice a bar that indicates the volume state."
	. "`n`nNote:`n'Taskbar' is a strip, usually positioned the bottom of your screen, where all your windows go when minimized. It also holds your Start button and the system clock."

	Gui, Add, Text, % "x15 ys+40 r16 w" width-30 " Center vTab41 +Hidden", % "Аdd a layer of protection to your personal computer. Being inactive for some period of time will result in your computer locking itself automatically."
	. "`n`nTo set it up, head over to the Protection Settings menu. You can customize the amount of time it takes, your PIN and much more! Locking is not possible without setting up your PIN first.`n`n"
	. "You can turn off the automatic locking by choosing 'Unprotected', but you will still be able to manually lock your PC if you have a hotkey set up."

	Gui, Add, Text, % "x15 ys+40 r16 w" width-30 " Center vTab51 +Hidden", % "You can find extensions on our website. Most of them provide functionality which is very useful to some, but not necessary for the everyday user."
	. "`n`nIn addition, you can create your own by heading over to the Extensions menu. `n`nThe library Functions.lib provides integrating functions like Notifications and more. Check out what is available to you in the files within 'Libraries'."
	. "`n`nWhen done, just reload the program and it will be in effect."

	Gui, Add, Text, % "x15 ys+40 w" (width/2) " vTab61 +Hidden Center c" darkerc, Version
	InVersionVar:= (InstalledVersion=1.0) ? "Unknown" : "v" . InstalledVersion
	Gui, Add, Text, % "x+0 w" (width/3.2) " vTab62 +Hidden Center c" lightc, %InVersionVar%
	Gui, Add, Text, % "x15 y+9 w" (width/2) " vTab63 +Hidden Center c" darkerc, Newest
	UpVersionVar:= (UpdateVersion=1.0) ? "Retrieving" : "v" . UpdateVersion
	Gui, Add, Text, % "x+0 w" (width/3.2) " vTab64 +Hidden Center c" lightc, %UpVersionVar%
	Gui, Add, Text, % "x15 y+25 w" (width/2) " vTab65 +Hidden Center c" darkerc, Creator
	Gui, Add, Text, % "x+0 w" (width/3.2) " vTab66 +Hidden Center c" lightc, Riyusso
	Gui, Add, Text, % "x15 y+9 w" (width/2) " vTab67 +Hidden Center c" darkerc, Tester
	Gui, Add, Text, % "x+0 w" (width/3.2) " vTab68 +Hidden Center c" lightc, physic
	Gui, Add, Text, % "x0 y+30 w" (width) " vTab69 +Hidden Center c" darkerc, Website
	Gui, Add, Text, % "x0 w" (width) " vTab610 +Hidden y+8 Center c" lightc, Devers.app
	Gui, Add, Text, % "x0 y+25 w" (width) " vTab611 +Hidden Center c" darkerc, Email
	Gui, Add, Text, % "x0 w" (width) " vTab612 +Hidden y+8 Center c" lightc, Riyusso@gmx.us

	Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " w" (width*0.64) "  y" height-44 " h33 gLearnMoreExit +hwndExitButtonTab +Default", Close

	Opt1 := [6, 0x2e2e2e, 0x2e2e2e, "White"]
	Opt2 := [ , 0x2e2e2e, 0x3f3f3f, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	ImageButton.Create(ExitButtonTab, Opt1, Opt2, "", Opt4)

	WinSet, Region, % "0-0 w" width*dpi " h" height*dpi " r6-6", ahk_id %LearnMore%

	If (LearnMoreTabAbout=1)
	{
		GoSub LearnMorePrev
		LearnMoreTabAbout:=false
	}

	Gui, Show, w%width% h%height%, Learn More
	FadeIn(LearnMore)
	WinSet, Transparent, 247

	if lastUpdateCheck>=3600000
		GoSub GetLatestVersion

	IniRead, UpdateVersion, build_update.ini, build, Version, 1.0
	UpVersionVar:= (UpdateVersion=1.0) ? "Offline" : "v" . UpdateVersion
	GuiControl, LearnMore:, Tab64, %UpVersionVar%
return

LearnMoreNext:
Loop, 12
	GuiControl, LearnMore:Hide, Tab%TabIndex%%A_Index%

If % TabIndex < TabCount
	TabIndex++
else
	TabIndex=1

Loop, 12
	GuiControl, LearnMore:Show, Tab%TabIndex%%A_Index%

GuiControl, LearnMore:, LearnMoreLabel, % LearnMoreLabels[TabIndex]

return

LearnMorePrev:
Loop, 12
	GuiControl, LearnMore:Hide, Tab%TabIndex%%A_Index%

If TabIndex > 1
	TabIndex--
else
	TabIndex := TabCount

Loop, 12
	GuiControl, LearnMore:Show, Tab%TabIndex%%A_Index%

GuiControl, LearnMore:, LearnMoreLabel, % LearnMoreLabels[TabIndex]
return

LearnMoreExit:
	FadeOut(LearnMore)
return

;--------------------------------------------------------------------------------------------------------------

MenuInit:
IfExist Assets\TrayIcon.ico
{
	Menu, Tray, Icon, Assets\TrayIcon.ico
	Menu, Tray, Icon
}
Else
{
	GoSub InstallFiles
	Menu, Tray, Icon, Assets\TrayIcon.ico
	Menu, Tray, Icon
}
If A_IsCompiled
	Menu, Tray, Tip, %ScriptName%. Make everyday tasks effortless.
Else
	Menu, Tray, Tip, Uncompiled
Menu, Tray, NoStandard
Menu, Tray, ADD, Menu, DefaultMenu
Menu, Tray, ADD, About, OpenLearnMoreTabAbout
Menu, Tray, ADD, Reload, mnuScriptReload
Menu, Tray, ADD, Quit, mnuExit
Menu, Tray, Default, Menu
Menu Tray, Click, 1           ; Enable single click action on tray
Return

mnuScriptReload:
	IntentReload=1
	Reload
Return

mnuUninstall:
	FadeOut(UninstallPrompt)
	FadeOut(OtherHWND)
	FadeOut(GeneralSettings)
	FadeOut(DefaultHWND)
	
	if !FirstRun
		RSNotify("Uninstalling")
	
	GoSub StopRunningPlugins

	Sleep 2000
	SplitPath, A_Scriptname, , , , OutNameNoExt
	LinkFile=%A_Startup%\%OutNameNoExt%.lnk
	StartMenuFile=%A_StartMenu%\Programs\%ScriptName%.lnk
	FileDelete, %StartMenuFile%
	FileDelete, %LinkFile%
	If A_IsAdmin
		Run, %comspec% /c SchTasks /F /Delete /TN RSRunScript, , HIDE
	FileInstall, Base\uninstaller.exe, %A_Temp%\uninstaller.exe, 1
	Run, %A_Temp%\uninstaller.exe,, HIDE
	ExitApp
return

SuspendScriptToggle:
Suspend, Toggle
Loop, Files, *.ahk
{
	SplitPath, A_LoopFileLongPath,,,, PluginName

	If RegExMatch(PluginName, "\W")
	{
		PluginName:=StrReplace(PluginName, A_Space, "_")
		PluginName := RegExReplace(PluginName, "\W")
		FileMove, %A_LoopFileLongPath%, %PluginName%.ahk, 1
	}

	IfWinExist, % "ahk_pid" PID%PluginName%
		PostMessage, 0x111, 65305,,, %PluginName%.ahk - AutoHotkey ; Suspend plugins.
}
If A_IsSuspended
{
	Menu, Tray, Icon, Assets\TrayIconSuspended.ico,,1
	Menu, Tray, Icon
	If !SuspendedByFullScreen
	RSNotify("Suspended")
}
If !A_IsSuspended
{
	Menu, Tray, Icon, Assets\TrayIcon.ico,,1
	Menu, Tray, Icon
	If !SuspendedByFullScreen
	RSNotify("Released")
}
return

mnuExit:
	FadeOut(DefaultHWND)
	GoSub ExitAppL
Return

ExitAppL:
	If IntentReload=1
		IniWrite, %IntentReload%, settings.ini, settings, Reloaded

	GoSub StopRunningPlugins

	Send {LAlt Up}{LShift Up} ; Needed incase a key was stuck
	ExitApp
return

StopRunningPlugins:
	for index, element in RunningPlugins
	{
		IfWinExist, % "ahk_pid" %element%
			WinKill, % "ahk_pid" %element%
	}
return

DefaultMenu:
	if(!DefaultFader)
	{
		DefaultFader:=true
		FadeOut(DefaultHWND)
		Gui, DefaultMenu:New, +hwndDefaultHWND
		Gui, +LastFound +AlwaysOnTop -Caption +ToolWindow
		WinSet, Transparent, 0
		Gui, Margin, 0, 0
		Gui, Font,  cFFFFFF Bold, Segoe UI
		Gui, Color, 232323
		amultiplier=1
		zfont=13

		If (A_ScreenHeight<2000)
		{
			amultiplier=1
			zfont=13
		}
		If (A_ScreenHeight<1800)
		{
			amultiplier=1
			zfont=12
		}
		If (A_ScreenHeight<1600)
		{
			amultiplier=0.92
			zfont=11
		}
		If (A_ScreenHeight<1400)
		{
			amultiplier=0.87
			zfont=11
		}
		If (A_ScreenHeight<1050)
		{
			amultiplier=0.80
			zfont=10
		}

		Gui, Font, s%zfont% cFFFFFF Bold q5
		guiw:=910*amultiplier
		guih:=56*amultiplier
		buth:=(guih)+2
		butw:=((guiw-60)/7)
		guipos:=(A_ScreenHeight)-(A_ScreenHeight/7+20)

		Opt1 := [6, 0x232323, 0x232323, "White"]
		Opt2 := [ , 0x292929, 0x282828, 0xffffff]
		Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

		Gui, Add, Button, % "x+0 y-1 h" buth " w" butw " gmnuScriptReload hwndBut1 +Center", Restart

		Gui, Add, Button, % "x+0 h" buth " w" butw " gSuspendScriptToggle hwndBut2 +Center", Suspend

		Gui, Add, Button, % "x+0 h" buth " w" butw+9 " gManualCheck hwndBut3 +Center", Update

		Gui, Add, Button, % "x+0 h" buth " w" butw+7 " gScriptFunctions hwndBut4 +Center", Features

		Gui, Add, Button, % "x+0 h" buth " w" butw+28 " gExtSettings hwndBut5 +Center", Extensions

		Gui, Add, Button, % "x+0 h" buth " w" butw " gsettings hwndBut6 +Center", Settings

		Gui, Add, Button, % "x+0 h" buth " w" butw-35 " gmnuExit hwndBut7 +Center",  Quit

		Gui, Add, Button, % "x+0 h" buth " w53 gExitDefMenu hwndBut8", ×

		ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
		ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
		ImageButton.Create(But3, Opt1, Opt2, "", Opt4)
		ImageButton.Create(But4, Opt1, Opt2, "", Opt4)
		ImageButton.Create(But5, Opt1, Opt2, "", Opt4)
		ImageButton.Create(But6, Opt1, Opt2, "", Opt4)
		ImageButton.Create(But7, Opt1, Opt2, "", Opt4)
		ImageButton.Create(But8, Opt1, Opt2, "", Opt4)
		WinSet, Region, % "0-0 w" guiw*dpi " h" guih*dpi " r50-50", ahk_id %DefaultHWND%
		Gui, Show, h%guih% w%guiw% y%guipos% NoActivate, Menu
		FadeIn(DefaultHWND)
		
		if lastUpdateCheck>=3600000
			GoSub GetLatestVersion

		IniRead, UpdateVersion, build_update.ini, build, Version, 1.0
		IniRead, InstalledVersion, build.ini, build, Version, 1.0
		IniRead, PromptVersion, build.ini, build, PromptVersion

		If % VersionCompare(UpdateVersion, InstalledVersion)=1
		{		
			If(PromptVersion!=UpdateVersion)
				GoSub UpdatePrompt
			else if !StillDownloading
				RSNotify("Update Available")
		}
	}
Return

ExitDefMenu:
FadeOut(DefaultHWND)
DefaultFader:=false
return

;--------------------------------------------------------------------------------------------------------------

SecurityLoggingLabel:
	Array := Object()
	Loop, Read, log.txt ; This loop retrieves each line from the file, one at a time.
	{
		Array.Insert(A_LoopReadLine)
	}
	elcount:=Array.MaxIndex() ; get the count of the lines in the log file
	calccount:=elcount-20 ; get the index of the last 20

	width :=330
	Gui, SecLogs:New, +hwndSecLogs
	Gui, +LastFound +ToolWindow
	WinSet, Transparent, 0
	Gui, Color, 2e2e2e
	Gui, Margin, 0, 0
	Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h31 Background2e2e2e Disabled hwndHPROG"

	Loop, 20
	{
		element:=Array[calccount+A_Index]
		if(A_Index=1 and element="")
		continue
		Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", %element%
	}

	Gui, Color, 2e2e2e
	Gui, Font, s11 cFFFFFF Bold, Segoe UI

	Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " y+22 w" (width*0.64) " gdestroySecLogs hwndBut1 +Center +Default", Close
	Opt1 := [6, 0x2e2e2e, 0x2e2e2e, "White"]
	Opt2 := [ , 0x2e2e2e, 0x444444, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	Gui, Add, Text, % "x+1 h46 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r12-12"
	Gui, Show, % "w" width  , Security Logs
	FadeIn(SecLogs)
return

destroySecLogs:
FadeOut(SecLogs)
return

;--------------------------------------------------------------------------------------------------------------

WarningGUI:
	width :=220
	Gui, WarningGUI:New, +hwndWarningGUI
	Gui, +LastFound +ToolWindow
	WinSet, Transparent, 0
	Gui, Color, 2e2e2e
	Gui, Margin, 0, 0
	Gui, Font, s11 cRed Bold, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h31 Background2e2e2e Disabled hwndHPROG"

	If(ProtectionWarning)
	{
		Gui, Add, Text, % "x0 y15 w" width " r1 BackgroundTrans Center 0x200 gGuiFade", Protection : Error
		Gui, Font, s8 cFFFFFF Bold, Tahoma
		Gui, Add, Text, % "x0 y+20 w" width " r1 BackgroundTrans Center 0x200 gGuiFade cD0D0D0", For the Protection to work:
		Gui, Add, Text, % "x0 y+0 w" width " r1 BackgroundTrans Center 0x200 gGuiFade cD0D0D0 h5",
		ProtectionWarning=0
	}
	Gui, Font, s8 cFFFFFF Bold, Tahoma

	If(Warning)
		Gui, Add, Text, % "x0 y+5 w" width " r1 BackgroundTrans Center 0x200 gGuiFade cD0D0D0", %Warning%

	Loop, 10
	If(Warning%A_Index%)
	{
		Gui, Add, Text, % "x0 y+6 w" width " r1 BackgroundTrans Center 0x200 gGuiFade cD0D0D0", % Warning%A_Index%
		Warning%A_Index%=
	}

	Gui, Add, Text, % "x+1 h46 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r12-12"
	Gui, Show, % "w" width  , Warning
	FadeIn(WarningGUI)
	If(Warning) ; If it's just a simple warning (Warning variable is used)
	{
		SetTimer, FadeOutWarning, -1800
		Warning=
	}
	else ; If it's an important warning (Warning1-10 variables are used)
		SetTimer, FadeOutWarning, -8500

return

FadeOutWarning:
	FadeOut(WarningGUI)
return

;--------------------------------------------------------------------------------------------------------------

PrInfo:
	width :=310
	Gui, PrInfo:New, +hwndPrInfo
	Gui, +LastFound +ToolWindow +AlwaysOnTop
	WinSet, Transparent, 0
	Gui, Color, 2e2e2e
	Gui, Margin, 0, 0
	Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w" (width+2) " h31 Background2e2e2e Disabled hwndHPROG"

	Gui, Add, Text, % "x0 y16 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", This extension will protect your  
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", personal computer from nosy people
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", when you're not around.
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", Configure the amount of time 
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", it takes while you're away
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans  Center 0x200 gGuiMove cD0D0D0", for the lock screen to appear.
		Gui, Font, s11 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+22 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0",  --- How to use it ---
		Gui, Font, s9 cFFFFFF Bold, Tahoma
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0",  Set the Protection dropdown to ON.
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0",  Set a password(PIN).
	Gui, Add, Text, % "x0 y+4 w" width " r1 BackgroundTrans Center 0x200 gGuiMove cD0D0D0",  Wait or press the lock button.

	Gui, Color, 2e2e2e
	Gui, Font, s11 cFFFFFF Bold, Tahoma

	Gui, Add, Button, % "x" (width/2)-((width*0.64)/2) " y+18 w" (width*0.64) " gdestroyPrInfo hwndBut1 +Center +Default", Close
	Opt1 := [6, 0x2e2e2e, 0x2e2e2e, "White"]
	Opt2 := [ , 0x2e2e2e, 0x444444, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)

	Gui, Add, Text, % "x+1 h46 vP"
	GuiControlGet, P, Pos
	H := PY + PH
	Gui, -Caption
	WinSet, Region, % "0-0 w" width*dpi " h" H*dpi " r12-12"
	Gui, Show, % "w" width  , Protection Settings
	FadeIn(PrInfo)
return

destroyPrInfo:
	FadeOut(PrInfo)
return

;--------------------------------------------------------------------------------------------------------------

AdminPrompt:
	width=144
	height=66
	Gui, AdminPrompt:New, +hwndAdminPrompt
	Gui, +LastFound +ToolWindow +AlwaysOnTop
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, -Caption
	Gui, Color, %guicolor%
	Gui, Font, s10 Bold, Tahoma
	Opt1 := [6, "0x" . guicolor, "0x" . guicolor, "White"]
	Opt2 := [ , "0x" . guicolor, "0x" . btnhovercolor, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	Gui, Add, Progress, % "x-1 y-1 w" width " h26 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, x0 y4 w%width% Center BackgroundTrans +0x200 c228a96, Are you an admin?

	Gui, Add, Button, % "x10 y30 w" Width/2-10 " +default gRunAsAdmin hwndBut1 +Center", Yeah
	Gui, Add, Button, % "x+0 y30 w" Width/2-10 " gNotAnAdmin hwndBut2 +Center", Nope

	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	WinSet, Region, % "0-0 w" width*dpi " h" height*dpi " r3-3", ahk_id %AdminPrompt%
	Gui, Show, w%width% h%height% , Are you an admin?
	FadeIn(AdminPrompt)
return

;--------------------------------------------------------------------------------------------------------------

Authorization:
	If WinActive("ahk_id" . Auth)
		return

	Gui, Auth:New, +hwndAuth
	Gui, +LastFound +ToolWindow +AlwaysOnTop
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, -Caption
	Gui, Color, 2b2b2a, 2b2b2a
	Gui, Font, s10 Bold c00afaf, Tahoma
	Gui, Add, Progress, % "x-1 y-1 w200 h26 Background1f1f1f Disabled hwndHPROG"
	Gui, Add, Text, x0 y4 w200 Center BackgroundTrans +0x200 cb1b1b1, Please authorize yourself.

	Gui, Font, w700 s12 c00afaf, Segoe UI Black
	Gui, Add, Edit, % "x0 y+13 w155 h25 hwndEdit265 vorigpass -E0x200 +Center -VScroll +password",

	Gui, Font, w700 s11 ceeeeee, Segoe UI Black
	Opt1 := [6, 0x2b2b2a, 0x2b2b2a, 0xD0D0D0]
	Opt2 := [ , 0x2b2b2a, 0x2b2b2a, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]

	Gui, Add, Button, x+0 w45 h25 +default gAuthorize hwndBut1 +Center, Go
	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)

	scaledw:=200
	scaledh:=70
	SHAutoComplete(Edit265)
	WinSet, Region, % "0-0 w" scaledw*dpi " h" scaledh*dpi " r12-12", ahk_id %Auth%
	; NoActivate fixes weird bug with not being able to switch language
	Gui, Show, w%scaledw% h%scaledh% NoActivate, Authorization
	WinActivate	
	; -----------------
	FadeIn(Auth)
	SetTimer, CheckIfAuthInactive, 200
return

Authorize:
	Gui, Submit, NoHide
	If (origpass=password && StrLen(origpass)>0)
	{
		FadeOut(Auth)
		Authorized:=true
		SetTimer, CheckIfAuthInactive, Off
		WinWaitNotActive, ahk_id %Auth%,,15
		{
			Sleep 20
			WinActivate, ahk_id %activeWindowForPassword%
			SendInput {Raw}%password%
		}
		SetTimer, AuthExpirationCheck, 2000
		If PasswordExpiration=1
			RSNotify("Secure")
		else if PasswordExpiration=2
		{
			SetTimer, AuthExpirationCheck, Off
			RSNotify("No Expiration")
			passwordNoExpirationHash := Crypt.Encrypt.StrEncrypt(passwordhash, password, 7, 3)
			IniWrite, %passwordNoExpirationHash%, settings.ini, settings, passwordNoExpirationHash
		}
		else
		{
			GoSub ExpirationPrompt
			SetTimer, KeepDefaultExpiration, -15000
		}
		StartTick:=A_TickCount
		FadeOut(Auth)
		return
	}
	Else
	{
		GuiControl, Auth:, origpass
		RSNotify("Not Authorized")
	}
return

ExpirationPrompt:
	width=255
	height=123
	Gui, ExpirationPrompt:New, +hwndExpirationPrompt
	Gui, +LastFound +ToolWindow +AlwaysOnTop
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, -Caption
	Gui, Color, 2b2b2a
	Gui, Font, s10 Bold, Tahoma
	Opt1 := [6, 0x2b2b2a, 0x2b2b2a, "White"]
	Opt2 := [ , 0x3b3b3a, 0x3b3b3a, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	Gui, Add, Progress, % "x-1 y-1 w" width " h30 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, x0 y6 w%width% Center BackgroundTrans +0x200 ceeeeee, Authorization ends after?
	Gui, Font, s10 Bold ceeeeee, Tahoma
	Gui, Add, Button, x0 y+8 w%width% h45 +default gKeepDefaultExpiration hwndBut1 +Center, 6 Minutes of inactivity

	Gui, Add, Button, x0 y+0 w%width% h47 gUntilRestartAuthExpiration hwndBut2 +Center, Until Restart

	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	WinSet, Region, % "0-0 w" width*dpi " h" height*dpi " r12-12", ahk_id %ExpirationPrompt%
	Gui, Show, % "x" (A_ScreenWidth)-width-50 "y " (A_ScreenHeight-height-80) " w" width " h" height " NoActivate",
	FadeIn(ExpirationPrompt)
return

UntilRestartAuthExpiration:
SetTimer, AuthExpirationCheck, Off
ExpirationPromptGuiEscape:
KeepDefaultExpiration:
IfWinExist, ahk_id %ExpirationPrompt%
	FadeOut(ExpirationPrompt)
return

AuthExpirationCheck:
	If (A_TimeIdle > 360000) or (A_TickCount - StartTick > 7500) ; Authorization will expire when computer goes to sleep or when idle for 6 minutes.
	{
		Authorized:=false
		SetTimer, AuthExpirationCheck, Off
	}
	StartTick:=A_TickCount
return

CheckIfAuthInactive:
	IfWinNotActive, ahk_id %Auth%
	{
		SetTimer, CheckIfAuthInactive, Off
		FadeOut(Auth)
	}
return

AuthExpire:
	Authorized:=false
	SetTimer, AuthExpirationCheck, Off
return

AuthGuiEscape:
	FadeOut(Auth)
return

;--------------------------------------------------------------------------------------------------------------

ManualCheck:
	ManualUpdateCheck:=true

UpdatePrompt:
	If StillDownloading {
		RSNotify("Still Downloading")
		return
	}
	If ManualUpdateCheck {
		GoSub GetLatestVersion
		ManualUpdateCheck:=false
	}
	IniRead, UpdateVersion, build_update.ini, build, Version, 1.0
	IniRead, InstalledVersion, build.ini, build, Version, 1.0

	If % VersionCompare(UpdateVersion, InstalledVersion)=1
	{
		width=150
		height=66
		Gui, UpdatePrompt:New, +hwndUpdatePrompt
		Gui, +LastFound +ToolWindow +AlwaysOnTop
		WinSet, Transparent, 0
		Gui, Margin, 0, 0
		Gui, -Caption
		Gui, Color, %guicolor%
		Gui, Font, s10 Bold, Tahoma
		Opt1 := [6, "0x" . guicolor, "0x" . guicolor, "White"]
		Opt2 := [ , "0x" . guicolor, "0x" . btnhovercolor, 0xffffff]
		Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
		Gui, Add, Progress, % "x-1 y-1 w" width " h26 Background1F2326 Disabled hwndHPROG"
		Gui, Add, Text, x0 y4 w%width% Center BackgroundTrans +0x200 c228a96 gGuiMove, Update to v%UpdateVersion%?

		Gui, Add, Button, x8 y30 w65 +default gUpdate hwndButUp1 +Center, Yeah
		Gui, Add, Button, x+5 y30 w65 gNoUpdate hwndButUp2 +Center, Nope

		ImageButton.Create(ButUp1, Opt1, Opt2, "", Opt4)
		ImageButton.Create(ButUp2, Opt1, Opt2, "", Opt4)
		WinSet, Region, % "0-0 w" width*dpi " h" height*dpi " r3-3", ahk_id %UpdatePrompt%
		Gui, Show, w%width% h%height% , Update Prompt
		FadeIn(UpdatePrompt)
	}
	Else
		RSNotify("No new versions")
return

;--------------------------------------------------------------------------------------------------------------

UninstallPrompt:
	width=155
	height=134
	Gui, UninstallPrompt:New, +hwndUninstallPrompt
	Gui, +LastFound +ToolWindow +AlwaysOnTop
	WinSet, Transparent, 0
	Gui, Margin, 0, 0
	Gui, -Caption
	Gui, Color, 2e2e2e
	Gui, Font, s10 Bold, Tahoma
	Opt1 := [6, 0x2e2e2e, 0x2e2e2e, "White"]
	Opt2 := [ , 0x2e2e2e, 0x3f3f3f, 0xffffff]
	Opt4 := [0, 0xC0A0A0A0, , 0xC0606000]
	Gui, Add, Progress, % "x-1 y-1 w" width " h26 Background1F2326 Disabled hwndHPROG"
	Gui, Add, Text, x0 y4 w%width% Center BackgroundTrans +0x200 cD0D0D0, Select your choice
	Gui, Add, Button, x0 y+7 h33 w%width% +default gmnuUninstall hwndBut1 +Center, Uninstall

	Gui, Add, Button, x0 y+2 h33 w%width% gReinstall hwndBut2 +Center, Repair

	Gui, Add, Button, x0 y+2 h33 w%width% gCancelUninstall  hwndBut3 +Center, Cancel

	ImageButton.Create(But1, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But2, Opt1, Opt2, "", Opt4)
	ImageButton.Create(But3, Opt1, Opt2, "", Opt4)
	WinSet, Region, % "0-0 w" width*dpi " h" height*dpi " r3-3", ahk_id %UninstallPrompt%
	Gui, Show, w%width% h%height% , Update Prompt
	FadeIn(UninstallPrompt)
return

UninstallPromptGuiEscape:
CancelUninstall:
	FadeOut(UninstallPrompt)
return